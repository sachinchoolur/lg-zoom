/*! lg-zoom - v1.1.0 - 2017-11-01
* http://sachinchoolur.github.io/lightGallery
* Copyright (c) 2017 Sachin N; Licensed GPLv3 */
!function(a,b,c,d){"use strict";var e={scale:1,zoom:!0,actualSize:!1,zoomIcons:!1,enableZoomAfter:300},f=a(b).width();f>1023&&(e.zoom=!1);var g=function(c){return this.core=a(c).data("lightGallery"),this.core.s=a.extend({},e,this.core.s),this.core.s.zoom&&this.core.doCss()&&(this.init(),this.zoomabletimeout=!1,this.pageX=f/2,this.pageY=a(b).height()/2+a(b).scrollTop()),this.core.imageData||(this.core.imageData={}),this};g.prototype.reinitialize=function(){var c;clearTimeout(c);var d=this,e=a(b).height(),f=a(b).width();d.core.viewportWidth=f,d.core.viewportHeight=e,c=setTimeout(function(){for(var a in d.core.imageData){if(d.core.imageData.hasOwnProperty(a)){var c=d.core.imageData[a],g=(f-c.$img.width())/2,h=(e-c.$img.height())/2;h=0!==b.orientation?h-25:h,c.initialOffsetX=g,c.initialOffsetY=h,c.width=c.$img.width(),c.height=c.$img.height(),d.core.setImageInfo(a),d.fitImage(a,!1),d.core.setTranslate(c.$img,g,h)}d.core.$slide.hasClass("lg-complete")&&d.fitImage(a,!0)}},300)},g.prototype.init=function(){var c,d=this;d.core.s.zoomIcons&&(c='<span id="lg-zoom-in" class="lg-icon"></span><span id="lg-zoom-out" class="lg-icon"></span>'),d.core.s.actualSize&&(c+='<span id="lg-actual-size" class="lg-icon"></span>'),this.core.$outer.find(".lg-toolbar").append(c),f<768&&d.core.$el.on("onBeforeSlide.lg",function(a,b,c){d.reinitialize()}),d.core.$el.off("onBeforeSlide.lg.tm.zoom").on("onBeforeSlide.lg.tm.zoom",function(a,b,c){d.fitImage(b,!0)}),d.core.$el.on("onSlideItemLoad.lg.tm.zoom",function(b,c,e){d.savePosition(c);var g=d.core.s.enableZoomAfter+e;a("body").hasClass("lg-from-hash")&&e?g=0:a("body").removeClass("lg-from-hash"),d.zoomabletimeout=setTimeout(function(){f<980&&d.core.$slide.eq(c).addClass("lg-zoomable")},g+30)}),d.core.$slide.on("dblclick",".lg-image",function(a){d.actualSize(a)});var e=0,g=!1;d.core.$slide.on("touchstart",".lg-image",function(a){a.preventDefault(),1===(e=a.originalEvent.touches&&a.originalEvent.touches.length)&&(g?(clearTimeout(g),g=null,d.actualSize(a)):g=setTimeout(function(){g=null},300))});a(b).off("resize.lg_zoom orientationchange.lg_zoom").on("resize.lg_zoom orientationchange.lg_zoom resize",function(){d.reinitialize()}),d.core.s.zoomIcons&&(a("#lg-zoom-out").off("click.lg").on("click.lg",function(){var a=d.core.imageData[d.core.index],b=+a.$wrap.attr("data-scale")||1;d.core.$outer.find(".lg-current .lg-image").length&&(b-=1,d.zoom(b),d.fitImage())}),a("#lg-zoom-in").off("click.lg").on("click.lg",function(){var a=d.core.imageData[d.core.index],b=+a.$wrap.attr("data-scale")||1;d.core.$outer.find(".lg-current .lg-image").length&&(b+=1,d.zoom(b),d.fitImage())})),d.core.s.actualSize&&a("#lg-actual-size").off("click.lg").on("click.lg",function(a){d.actualSize(a,!0)}),d.core.isTouch?d.zoomPitch():(d.mouseDrag(),d.scrollZoom())},g.prototype.zoomPitch=function(){function a(a){if(!k.core.isDraging){var b=d(a);g=k.core.imageData[k.core.index],n=+g.$img.attr("data-scale")||g.scale||1,o||(o=!0,h=b[0],g=k.core.imageData[k.core.index]),!p&&b.length>=2&&(p=!0,k.savePosition(),h=e(b)),k.isZoomed&&a.preventDefault(),l=f(b)}}function b(a){if(!k.core.isDraging){a.preventDefault();var b,c=d(a),g=0,o=0,p=n;if(i=c[0],k.core.$outer.addClass("lg-zoom-dragging lg-no-trans"),j=e(c),m=f(c),2===c.length){var q=m-l;b=4*Math.floor(100*q/k.core.viewportHeight),p=n*parseFloat((100+b)/100)}k.isZoomed&&(g=j.x-h.x,o=j.y-h.y),(n!==p||k.isZoomed&&(g||o))&&k.zoom(p,j.x,j.y,g,o)}}function c(a){if(!k.core.isDraging){var b=d(a);n=+g.$img.attr("data-scale"),1===b.length&&(h=b[0],i=b[0],k.savePosition()),b.length<=1&&(p=!1),0===b.length&&(o=!1,k.fitImage())}}function d(a){if(!a.originalEvent.touches)return!1;var b=[];for(var c in a.originalEvent.touches)if(a.originalEvent.touches.hasOwnProperty(c)){var d=a.originalEvent.touches[c];if(!d.clientX)continue;b.push({x:d.clientX,y:d.clientY})}return b}function e(a){var b=0,c=0;return a.forEach(function(a){b+=a.x,c+=a.y}),{x:b/a.length,y:c/a.length}}function f(a){return a.length>1?Math.sqrt(Math.pow(a[1].x-a[0].x,2)+Math.pow(a[1].y-a[0].y,2)):0}var g,h,i,j,k=this,l=0,m=0,n=1,o=!1,p=!1;k.core.$slide.off("touchstart.lg_zoom_pitch").on("touchstart.lg_zoom_pitch",a),k.core.$slide.off("touchmove.lg_zoom_pitch").on("touchmove.lg_zoom_pitch",b),k.core.$slide.off("touchend.lg_zoom_pitch").on("touchend.lg_zoom_pitch",c)},g.prototype.scrollZoom=function(){var a,b=this;b.core.$slide.off("mousewheel.lg_zoom").on("mousewheel.lg_zoom",function(c){var d=c.originalEvent,e=b.core.imageData[b.core.index];if(e&&!b.core.isDraging){var f=+e.$img.attr("data-scale")||1,g=Math.max(-1,Math.min(1,d.wheelDelta||-d.detail))/10*(f+1),h=f+g,i=d.pageX,j=d.pageY;h>e.maxScale||(b.zoom(h,i,j),b.savePosition(),clearTimeout(a),a=setTimeout(function(){b.fitImage()},150),c.preventDefault())}})},g.prototype.mouseDrag=function(){var c=this,d={},e={},f=!1;c.core.$slide.on("mousedown.lg_zoom",function(b){c.core.imageData[c.core.index];c.isZoomed&&a(b.target).hasClass("lg-object")&&(b.preventDefault(),d={x:b.pageX,y:b.pageY},f=!0,c.core.$outer.scrollLeft+=1,c.core.$outer.scrollLeft-=1,c.core.$outer.removeClass("lg-grab").addClass("lg-grabbing"))}),a(b).on("mousemove.lg_zoom",function(a){if(f){var b,g,h=c.core.imageData[c.core.index];e={x:a.pageX,y:a.pageY},c.core.$outer.addClass("lg-zoom-dragging"),b=e.x-d.x,g=e.y-d.y,c.zoom(h.scale,0,0,b,g)}}),a(b).on("mouseup.lg_zoom",function(a){f&&(f=!1,c.fitImage()),(c.core.s.enableDrag||c.isZoomed)&&c.core.$outer.removeClass("lg-grabbing").addClass("lg-grab")})},g.prototype.checkPosition=function(c,d,e,f,g){var h,i,j=this,k=0,l=0;void 0===g&&(g=j.core.index);var m=j.core.imageData[g];if(m){f=f||+m.$img.attr("data-scale")||1,f>m.maxScale&&(f=m.maxScale),c?f<1&&(f=1):f<1&&(f=1-.2*(1-f))<.5&&(f=.5);var n=m.width*f,o=m.height*f,p=n>j.core.viewportWidth,q=o>j.core.viewportHeight;if(p?(k=0,h=j.core.viewportWidth-n):(k=(j.core.viewportWidth-n)/2,h=k),q?(l=0,i=j.core.viewportHeight-o):(l=(a(b).height()-o)/2,i=l),!c){var r,s,t=.05*f;r=d>=0?(d-k)*t:(d-h)*t,s=e>=0?(e-l)*t:(e-i)*t,k+=r,h+=r,l+=s,i+=s}return d>k?d=k:d<h&&(d=h),e>l?e=l:e<i&&(e=i),{x:d,y:e,scale:f}}},g.prototype.actualSize=function(c,d){var e=this,f=e.core.index,g=e.core.imageData[f];if(g){var h,i,j=+g.$img.attr("data-scale")||1;j=e.isZoomed?1:g.maxScale,d||(h=c.pageX||c.originalEvent.targetTouches[0].pageX,i=(c.pageY||c.originalEvent.targetTouches[0].pageY)-a(b).scrollTop()),e.zoom(j,h,i),e.savePosition(),setTimeout(function(){e.core.s.enableDrag||e.isZoomed?e.core.$outer.removeClass("lg-grabbing").addClass("lg-grab"):e.core.$outer.removeClass("lg-grab lg-grabbing")},10)}},g.prototype.fitImage=function(a,b){var c=this;if(void 0===a&&(a=this.core.index),c.core.imageData){var d=c.core.imageData[a];if(d){c.core.$outer.removeClass("lg-zoom-dragging lg-no-trans");var e=d.initialOffsetX,g=d.initialOffsetY,h=1;e=+d.$img.attr("data-x")||e,g=+d.$img.attr("data-y")||g,h=+d.$img.attr("data-scale")||h;var i=c.checkPosition(!0,e,g,h,a);c.setPosition(i.x,i.y,i.scale,a),768===f&&c.setPosition(i.x,i.y-40,i.scale,a),d.$img.css("margin-top","0"),c.savePosition(),i.scale<=1&&(c.isInZoom=!1)}}},g.prototype.zoom=function(a,b,c,d,e){var g=this,h=this.core.imageData[this.core.index];if(h&&a){var i,j;a>h.maxScale&&(a=h.maxScale),b&&c||(b=g.core.viewportWidth/2,c=g.core.viewportHeight/2);var k=a/h.scale;i=h.offsetX+(h.offsetX-b)*(k-1),j=h.offsetY+(h.offsetY-c)*(k-1);void 0!==d&&void 0!==e&&(i+=d*k,j+=e*k);var l=g.checkPosition(!1,i,j,a);f>767?g.setPosition(l.x,l.y-50,l.scale):g.setPosition(l.x,l.y,l.scale),g.isInZoom=!0,g.isZoomed=l.scale>1,g.core.$outer.toggleClass("lg-zoomed",a>1),g.core.$outer.toggleClass("lg-zoom-max",a>=h.maxScale),g.core.$slide.removeAttr("style")}},g.prototype.savePosition=function(a){var b=this;a=void 0!==a?a:this.core.index;var c=b.core.imageData[a];c&&(c.scale=+c.$img.attr("data-scale")||1,c.offsetX=+c.$img.attr("data-x")||c.initialOffsetX,c.offsetY=+c.$img.attr("data-y")||c.initialOffsetY)},g.prototype.resetZoom=function(a){var b=this;a=void 0!==a?a:this.core.index,b.core.imageData[a]&&(this.core.$outer.removeClass("lg-zoomed"),this.isZoomed=!1,this.isInZoom=!1,this.zoom(1,0,0,a),this.savePosition(a))},g.prototype.setPosition=function(c,d,e,f){var g=this;void 0===f&&(f=g.core.index);var h=g.core.imageData[f];e=e||h.$img.attr("data-scale")||1,c=Math.floor(c)||0,d=Math.floor(d)||0,e>1.75?(d=Math.floor(d)+40||0,a(".lg-image").css({display:"none",visibility:"hidden"})):e<1.75&&(d=Math.floor(d),a(".lg-image").css({display:"block",visibility:"visible"})),0!==b.orientation&&(d=Math.floor(d)-25||0),h.$img.css({transform:"translate3d("+c+"px, "+d+"px, 0) scale("+e+")"}).attr("data-x",c).attr("data-y",d).attr("data-scale",e)},g.prototype.destroy=function(){var c=this;c.core.$el.off(".lg_zoom"),a(b).off(".lg_zoom"),c.core.$slide.off(".lg_zoom"),c.core.$el.off(".lg.tm.zoom"),c.resetZoom(),clearTimeout(c.zoomabletimeout),c.zoomabletimeout=!1},setTimeout(function(){a.fn.lightGallery.modules.zoom=g},300)}(jQuery,window,document);